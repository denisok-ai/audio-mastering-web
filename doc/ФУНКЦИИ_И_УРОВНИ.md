# Функции и уровни доступа (Magic Master)

Документ описывает **текущее** разделение функций на **без регистрации (Free)** и **по подписке (Pro/Studio)** и возможные доработки.

> **Обновлено:** 2026-02-28. Все запланированные фазы P0–P53 реализованы (см. [PROGRESS.md](../PROGRESS.md)).

---

## 1. Что уже сделано и что можно доработать

### Реализовано

- Загрузка и экспорт (WAV, MP3, FLAC, OPUS), мастеринг по цепочке модулей, жанровые пресеты.
- Анализ: LUFS, спектр, векторскоп, график LUFS по времени, стерео-корреляция, экспорт отчёта (TXT/JSON/PDF).
- Настройка цепочки (порядок, Amount, phase mode, reverb, M/S, дизеринг, auto-blank, oversampling).
- **Авторизация:** регистрация, вход, JWT, сброс пароля, верификация email, профиль, API-ключи (Pro/Studio).
- **Лимиты:** Free — 3 мастеринга/день по IP; Pro/Studio — по тарифу; приоритетная очередь для Pro.
- **Пакетная обработка** (batch), **сохранение пресетов** цепочки, **история на сервере**, дашборд, админ-панель.
- **Мобильная адаптация**, A/B плеер с LUFS, AI-агенты (рекомендатор, отчёт, авто-мастеринг, NL→настройки, чат).
- API v2, тесты (auth, admin, payments), PWA, Docker prod, Nginx, страница статуса, документация API.

### Что можно доработать (кандидаты на следующие фазы)

| Задача | Описание | Приоритет |
|--------|----------|-----------|
| Плагины/расширения | Дополнительные процессоры или пресеты от сообщества | Низкий |
| Доп. форматы/качество | Другие кодеки или битрейты по запросу | Низкий |
| Улучшение тестов | Расширение покрытия pipeline, AI, batch | Низкий |

---

## 2. Что можно давать без регистрации (Free)

Рекомендуется оставить **без регистрации** всё, что нужно для быстрой оценки сервиса и разового мастеринга:

| Функция | Комментарий |
|---------|-------------|
| Загрузка одного файла | WAV, MP3, FLAC до лимита (например 100 МБ или 10 мин) |
| Замер громкости (LUFS) | Текущий уровень, спектр, векторскоп, график LUFS по времени |
| Один пресет по умолчанию | Например только «Stream −14 LUFS» без выбора жанров |
| Один мастеринг в день (или 3–5 в день) | Лимит по IP или по cookie, без аккаунта |
| Экспорт в WAV | Только WAV; MP3/FLAC — по подписке или платно за раз |
| Документация API (чтение) | Просмотр /docs для разработчиков |

Ограничения для гостей (без регистрации):

- Лимит длины трека: например до 5–10 минут.
- Лимит мастерингов: например 3–5 в день с одного IP.
- Без сохранения настроек и истории на сервере (только localStorage).
- Без пакетной обработки.

---

## 3. Что можно давать с подпиской (Premium / Pro)

После введения регистрации и подписки логично перенести в платный уровень:

| Функция | Уровень | Комментарий |
|---------|---------|-------------|
| Все жанровые пресеты | Подписка | EDM, Hip-Hop, Classical, Podcast, Lo-fi, House и др. |
| Настройка цепочки модулей | Подписка | Порядок, Amount, phase mode, reverb, M/S, oversampling |
| Экспорт в MP3 и FLAC | Подписка или Free с лимитом | Либо только для подписчиков, либо N экспортов в MP3/FLAC в месяц для Free |
| Без лимита по длине трека | Подписка | Например до 30–60 минут на трек |
| Больше мастерингов в день | Подписка | Например 20–50 в день или без жёсткого лимита |
| Сохранение пресетов и цепочек | Подписка | Привязка к аккаунту, облако |
| История на сервере | Подписка | Доступ с любого устройства |
| Пакетная обработка | Подписка (Pro) | Несколько файлов за раз |
| Приоритетная очередь | Подписка (Pro) | Меньше ожидание при нагрузке |
| Расширенный анализ | Подписка (Pro) | Доп. метрики, отчёты, экспорт отчёта |

---

## 4. Сводная таблица (без регистрации vs подписка)

| Функция | Без регистрации | С подпиской |
|---------|------------------|-------------|
| Загрузка файла (WAV/MP3/FLAC) | ✅ до лимита по размеру/длине | ✅ без жёсткого лимита |
| Замер LUFS, спектр, векторскоп | ✅ | ✅ |
| Пресет «Stream −14 LUFS» | ✅ | ✅ |
| Остальные жанровые пресеты | ❌ | ✅ |
| Редактирование цепочки модулей | ❌ | ✅ |
| Мастеринг | ✅ 3–5 раз в день (пример) | ✅ по тарифу |
| Экспорт WAV | ✅ | ✅ |
| Экспорт MP3/FLAC | ❌ или лимит | ✅ |
| Сохранение пресетов/проектов | ❌ | ✅ |
| История на сервере | ❌ | ✅ |
| Пакетная обработка | ❌ | ✅ (Pro) |

---

## 5. Текущее состояние продукта

**Авторизация и подписки реализованы.** Доступны регистрация, вход, сброс пароля, верификация email; тарифы Free / Pro / Studio с лимитами и приоритетной очередью; YooKassa для оплаты; админ-панель (пользователи, транзакции, новости, рассылки, настройки). Режим отладки (`MAGIC_MASTER_DEBUG=1`) даёт доступ ко всем функциям без входа для локальной разработки. Разделение по таблицам выше соответствует текущей реализации.
